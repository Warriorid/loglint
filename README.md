# loglint

`loglint` — статический анализатор (линтер) для Go, который проверяет лог-сообщения на соответствие правилам форматирования, стиля и безопасности. Работает как самостоятельная утилита и как плагин для [`golangci-lint`](https://golangci-lint.run/).

## Правила

| # | Правило | Неправильно | Правильно |
|---|---------|------------|-----------|
| 1 | Строчная буква в начале | `log.Info("Starting server")` | `log.Info("starting server")` |
| 2 | Только английский язык | `log.Error("ошибка подключения")` | `log.Error("connection failed")` |
| 3 | Нет спецсимволов и эмодзи | `log.Warn("something went wrong...")` | `log.Warn("something went wrong")` |
| 4 | Нет чувствительных данных | `log.Info("user token: " + token)` | `log.Info("user authenticated")` |

## Бонусные функции

- **Авто-исправление:** флаг `-fix` автоматически исправляет регистр первой буквы
- **Гибкая конфигурация:** каждое правило можно включить или отключить отдельно
- **Кастомные паттерны:** можно задать свой список ключевых слов для проверки на чувствительные данные

## Поддерживаемые логгеры

- Стандартный пакет `log`
- `log/slog` (включая `InfoCtx`, `DebugCtx`, `Log` и другие)
- `go.uber.org/zap` (включая `Infof`, `Debugw`, `DPanic` и другие)



## Способы запуска

### 1. Через `go run` (без предварительной сборки)

Самый простой способ — не требует сборки бинарника:

```bash
# Проверить тестовые данные
go run ./cmd/loglint/ ./testdata/src/basic/

# Проверить весь проект рекурсивно
go run ./cmd/loglint/ ./...

# Проверить конкретный пакет
go run ./cmd/loglint/ ./internal/analyzer/
```

### 2. Через собранный бинарник

Подходит для регулярного использования — после сборки запуск быстрее:

```bash
# Собрать бинарник (один раз)
go build -o .bin/loglint ./cmd/loglint/

# Проверить весь проект
./.bin/loglint ./...

# Проверить конкретный пакет
./.bin/loglint ./internal/analyzer/

# Проверить тестовые данные
./.bin/loglint ./testdata/src/basic/
```

### 3. Через `go vet`

Интеграция со стандартным инструментом Go:

```bash
# Собрать бинарник (если ещё не собран)
go build -o .bin/loglint ./cmd/loglint/

# Запустить через go vet
go vet -vettool=./.bin/loglint ./...
```

## Флаги

| Флаг | Описание |
|------|----------|
| `-fix` | Автоматически исправить регистр первой буквы |
| `-diff` | Показать diff изменений вместо применения |
| `-json` | Вывод результатов в JSON |
| `-c N` | Показать N строк контекста вокруг ошибки |
| `-test` | Анализировать тестовые файлы (по умолчанию `true`) |

Примеры:

```bash
# Авто-исправление заглавных букв
go run ./cmd/loglint/ -fix ./...

# Посмотреть diff без изменения файлов
go run ./cmd/loglint/ -fix -diff ./...

# Вывод в JSON
go run ./cmd/loglint/ -json ./...

# Показать 3 строки контекста вокруг каждой ошибки
go run ./cmd/loglint/ -c 3 ./...

# Исключить тестовые файлы
go run ./cmd/loglint/ -test=false ./...
```

## Коды возврата

| Код | Значение |
|-----|----------|
| `0` | Нарушений не найдено |
| `1` | Ошибка инструмента или неверные аргументы |
| `2` | Ошибка сборки анализируемого кода |
| `3` | Нарушения найдены (штатная работа) |

## Запуск тестов

```bash
# Все тесты
go test ./...

# С подробным выводом
go test -v ./...

# Только unit-тесты правил
go test ./internal/rules/...

# Только тесты анализатора
go test ./internal/analyzer/...

# С покрытием кода
go test -cover ./...

# Сохранить HTML-отчёт о покрытии
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out
```